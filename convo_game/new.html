<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Corridor Adventure - Side View</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background-color: #111;
      perspective: 1000px;
      overflow: hidden;
    }
    
    #game-world {
      position: absolute;
      width: 100%;
      height: 100%;
      transition: transform 0.8s ease-in-out;
    }
    
    /* Ground styling */
    #ground {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 20vh;
      background-image: linear-gradient(#554, #332);
      box-shadow: inset 0 5px 20px rgba(0,0,0,0.5);
    }
    
    /* Wall styling */
    #wall {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 80vh;
      background-image: linear-gradient(#444, #333);
      box-shadow: inset 0 0 50px rgba(0,0,0,0.7);
      overflow: hidden;
    }
    
    /* Vines on the wall */
    .vine {
      position: absolute;
      width: 2px;
      background-color: #2a4d1d;
      transform-origin: top center;
      z-index: 5;
    }
    
    .vine::before, .vine::after {
      content: "";
      position: absolute;
      width: 15px;
      height: 10px;
      background-color: #3a6a2a;
      border-radius: 50% 50% 0 50%;
      transform: rotate(45deg);
      opacity: 0.8;
    }
    
    /* Stars in the background */
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background-color: white;
      border-radius: 50%;
      opacity: 0.7;
      animation: twinkle 4s infinite alternate;
    }
    
    @keyframes twinkle {
      0% { opacity: 0.3; }
      50% { opacity: 0.8; }
      100% { opacity: 0.3; }
    }
    
    /* Falling leaves */
    .leaf {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #5a7247;
      border-radius: 50% 0 50% 0;
      opacity: 0.6;
      animation: falling 10s linear infinite;
      z-index: 6;
    }
    
    @keyframes falling {
      0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
      10% { opacity: 0.6; }
      100% { transform: translateY(80vh) rotate(360deg); opacity: 0; }
    }
    
    /* Player styling */
    #player {
      position: absolute;
      bottom: 20vh;
      left: 45vw;
      width: 10vw;
      height: 20vh;
      background-image: linear-gradient(transparent 20%, #555 20%, #333 90%, #222 90%);
      border-radius: 50% 50% 0 0;
      z-index: 10;
      transition: transform 0.3s ease-out;
    }
    
    #player::before {
      content: "";
      position: absolute;
      top: 20%;
      left: 25%;
      width: 50%;
      height: 40%;
      background-color: #222;
      border-radius: 50%;
    }
    
    .door {
      position: absolute;
      height: 30vh;
      width: 10vw;
      background-color: #5a3921;
      border: 4px solid #412a18;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: filter 0.3s, box-shadow 0.3s, transform 0.3s;
      bottom: 20vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .door:hover {
      filter: brightness(1.3);
    }
    
    .doorknob {
      position: absolute;
      right: 10%;
      top: 50%;
      width: 10%;
      height: 5%;
      background-color: #b8860b;
      border-radius: 50%;
    }
    
    #door1 {
      left: 200vw;
      /* Highlighting the first door */
      box-shadow: 0 0 15px rgba(255, 255, 0, 0.8);
      animation: highlight 1.5s infinite alternate;
    }
    
    @keyframes highlight {
      from { box-shadow: 0 0 15px rgba(255, 255, 0, 0.8); }
      to { box-shadow: 0 0 25px rgba(255, 255, 0, 1); }
    }
    
    #door2 {
      left: 230vw;
    }
    
    #door3 {
      left: 260vw;
    }
    
    #door4 {
      left: 290vw;
    }
    
    #door5 {
      left: 320vw;
      height: 40vh;
      width: 12vw;
      background-color: #4a1c82;
      border: 8px solid #321258;
      box-shadow: 0 0 20px rgba(148, 0, 211, 0.7);
    }
    
    #door5:hover {
      box-shadow: 0 0 30px rgba(148, 0, 211, 0.9);
    }
    
    #door5::before {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(148, 0, 211, 0.2), transparent);
      animation: pulse 3s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 0.3; }
      50% { opacity: 0.7; }
      100% { opacity: 0.3; }
    }
    
    #door5 .doorknob {
      background-color: gold;
      box-shadow: 0 0 10px goldenrod;
    }
    
    .door-number {
      color: #ccc;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 0 0 5px black;
    }
    
    #door5 .door-number {
      font-size: 32px;
      color: gold;
      text-shadow: 0 0 10px purple;
    }
    
    .torch {
      position: absolute;
      width: 2vw;
      height: 8vh;
      background-color: #333;
      box-shadow: 0 0 5px black;
      bottom: 20vh;
    }
    
    .torch::after {
      content: "";
      position: absolute;
      top: -4vh;
      left: 0;
      width: 2vw;
      height: 4vh;
      background-color: #ff8c00;
      border-radius: 50% 50% 0 0;
      animation: flicker 0.5s infinite alternate;
    }
    
    @keyframes flicker {
      0% { box-shadow: 0 0 10px #ff8c00, 0 0 20px #ff8c00; opacity: 0.8; }
      100% { box-shadow: 0 0 5px #ff8c00, 0 0 10px #ff8c00; opacity: 1; }
    }
    
    #torch1 {
      left: 190vw;
    }
    
    #torch2 {
      left: 220vw;
    }
    
    #torch3 {
      left: 250vw;
    }
    
    #torch4 {
      left: 280vw;
    }
    
    #torch5 {
      left: 310vw;
    }
    
    #torch6 {
      left: 340vw;
    }
    
    /* Controls */
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }
    
    /* Joystick styling */
    #joystick-container {
      position: relative;
      width: 150px;
      height: 150px;
      background-color: rgba(50, 50, 50, 0.5);
      border-radius: 50%;
      margin: 0 auto;
      touch-action: none;
    }
    
    #joystick-base {
      position: absolute;
      top: 25px;
      left: 25px;
      width: 100px;
      height: 100px;
      background-color: rgba(80, 80, 80, 0.8);
      border-radius: 50%;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    }
    
    #joystick-knob {
      position: absolute;
      top: 50px;
      left: 50px;
      width: 50px;
      height: 50px;
      background-color: #666;
      border-radius: 50%;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
      cursor: grab;
      transform: translate(-50%, -50%);
      transition: background-color 0.2s;
    }
    
    #joystick-knob:hover {
      background-color: #888;
    }
    
    #joystick-knob:active {
      cursor: grabbing;
      background-color: #aaa;
    }
    
    #forward-button {
      padding: 10px 20px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      margin: 0 auto;
    }
    
    #forward-button::after {
      content: "â–²";
      margin-left: 8px;
    }
    
    #forward-button:hover {
      background-color: #666;
    }
    
    /* Door view */
    #door-view {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 200;
    }
    
    #close-door-view {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      cursor: pointer;
    }
    
    #close-door-view:hover {
      background-color: #555;
    }
    
    #current-door {
      width: 20vw;
      height: 60vh;
      background-color: #5a3921;
      border: 15px solid #412a18;
      box-shadow: 0 0 30px black;
      position: relative;
      transform-origin: left;
      transition: transform 1s;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #current-door .doorknob {
      right: 10%;
      width: 10%;
      height: 5%;
    }
    
    #current-door .door-number {
      font-size: 72px;
    }
    
    .door-closed {
      transform: rotateY(0);
    }
    
    .door-open {
      transform: rotateY(-80deg);
    }
    
    #door-content {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      padding: 20px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s;
      z-index: -1;
    }
    
    /* Game over screen */
    #game-over {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 300;
      color: white;
      font-size: 48px;
      text-align: center;
    }
    
    #restart-button {
      margin-top: 30px;
      padding: 15px 30px;
      background-color: #540;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 24px;
    }
    
    #restart-button:hover {
      background-color: #760;
    }
    
    /* Position indicator */
    #position-indicator {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background-color: rgba(0,0,0,0.7);
      padding: 10px;
      color: white;
      border-radius: 5px;
    }
    
    /* Initial help text */
    #help-text {
      position: absolute;
      top: 20px;
      left: 20px;
      background-color: rgba(0,0,0,0.7);
      padding: 15px;
      color: white;
      border-radius: 5px;
      max-width: 300px;
      font-size: 14px;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="game-world">
      <div id="wall">
        <!-- Stars in the night sky -->
        <div class="star" style="top: 5%; left: 10%;"></div>
        <div class="star" style="top: 15%; left: 25%; width: 3px; height: 3px;"></div>
        <div class="star" style="top: 8%; left: 40%;"></div>
        <div class="star" style="top: 20%; left: 60%; width: 3px; height: 3px;"></div>
        <div class="star" style="top: 12%; left: 75%;"></div>
        <div class="star" style="top: 7%; left: 85%; width: 3px; height: 3px;"></div>
        <div class="star" style="top: 18%; left: 95%;"></div>
        <div class="star" style="top: 25%; left: 15%; width: 3px; height: 3px;"></div>
        <div class="star" style="top: 30%; left: 35%;"></div>
        <div class="star" style="top: 22%; left: 55%; width: 3px; height: 3px;"></div>
        <div class="star" style="top: 28%; left: 70%;"></div>
        <div class="star" style="top: 35%; left: 90%; width: 3px; height: 3px;"></div>
        
        <!-- Vines on the walls -->
        <div class="vine" style="top: 0; left: 15%; height: 40vh; transform: rotate(5deg);"></div>
        <div class="vine" style="top: 0; left: 35%; height: 30vh; transform: rotate(-3deg);"></div>
        <div class="vine" style="top: 0; left: 65%; height: 45vh; transform: rotate(2deg);"></div>
        <div class="vine" style="top: 0; left: 85%; height: 35vh; transform: rotate(-4deg);"></div>
        
        <!-- Falling leaves -->
        <div class="leaf" style="left: 20%; animation-delay: 0s;"></div>
        <div class="leaf" style="left: 40%; animation-delay: 3s;"></div>
        <div class="leaf" style="left: 60%; animation-delay: 6s;"></div>
        <div class="leaf" style="left: 80%; animation-delay: 9s;"></div>
      </div>
      <div id="ground"></div>
      
      <div id="player"></div>
      
      <div class="door" id="door1">
        <span class="door-number">1</span>
        <div class="doorknob"></div>
      </div>
      <div class="door" id="door2">
        <span class="door-number">2</span>
        <div class="doorknob"></div>
      </div>
      <div class="door" id="door3">
        <span class="door-number">3</span>
        <div class="doorknob"></div>
      </div>
      <div class="door" id="door4">
        <span class="door-number">4</span>
        <div class="doorknob"></div>
      </div>
      <div class="door" id="door5">
        <span class="door-number">5</span>
        <div class="doorknob"></div>
      </div>
      
      <div class="torch" id="torch1"></div>
      <div class="torch" id="torch2"></div>
      <div class="torch" id="torch3"></div>
      <div class="torch" id="torch4"></div>
      <div class="torch" id="torch5"></div>
      <div class="torch" id="torch6"></div>
    </div>
    
    <div id="controls">
      <div id="joystick-container">
        <div id="joystick-base"></div>
        <div id="joystick-knob"></div>
      </div>
    </div>
    
    <div id="position-indicator">Position: 0</div>
    
    <div id="help-text">
      Use the joystick or keyboard (Arrow keys/WASD) to move in all directions.
      Move forward to get closer to doors, and move left/right to navigate the corridor.
      Find and open the glowing Door 1 to begin your adventure!
    </div>
  </div>
  
  <div id="door-view">
    <button id="close-door-view">Back to Corridor</button>
    <div id="current-door" class="door-closed">
      <span class="door-number"></span>
      <div class="doorknob"></div>
    </div>
    <div id="door-content"></div>
  </div>
  
  <div id="game-over">
    <div id="game-over-message"></div>
    <button id="restart-button">Play Again</button>
  </div>
  
  <script>
    const gameWorld = document.getElementById('game-world');
    const player = document.getElementById('player');
    const positionIndicator = document.getElementById('position-indicator');
    const doorView = document.getElementById('door-view');
    const closeDoorViewButton = document.getElementById('close-door-view');
    const currentDoor = document.getElementById('current-door');
    const doorContent = document.getElementById('door-content');
    const gameOver = document.getElementById('game-over');
    const gameOverMessage = document.getElementById('game-over-message');
    const restartButton = document.getElementById('restart-button');
    const helpText = document.getElementById('help-text');
    const joystickContainer = document.getElementById('joystick-container');
    const joystickKnob = document.getElementById('joystick-knob');
    
    const doors = [
      document.getElementById('door1'),
      document.getElementById('door2'),
      document.getElementById('door3'),
      document.getElementById('door4'),
      document.getElementById('door5')
    ];
    
    const doorContents = [
      "You found a rusty key. It might be useful later.",
      "A strange symbol is carved onto the wall. It glows faintly.",
      "This room is empty except for a small chest that's locked tight.",
      "You see a mysterious map on the wall with an X marking something important.",
      "Congratulations! You've reached the magical door and unlocked the secrets beyond!"
    ];
    
    let currentX = 0;
    let maxX = 350;
    let moveSpeed = 5;
    
    // Forward movement variables
    let isForwardMode = false;
    let currentZ = 0;
    let targetDoorIndex = -1;
    
    // Update the player position
    function updatePosition() {
      // Move the game world instead of the player (parallax effect)
      gameWorld.style.transform = `translateX(${-currentX}vw)`;
      
      // Update position indicator
      positionIndicator.textContent = `Position: ${Math.floor(currentX / 10)}/35`;
      
      // Update door interactivity based on position
      updateDoorInteractivity();
    }
    
    // Update which doors are interactive based on position
    function updateDoorInteractivity() {
      doors.forEach((door, index) => {
        const doorX = 200 + (index * 30); // Door positions are 200, 230, 260, 290, 320
        
        // A door is interactive if the player is within 10 units of the door
        const distance = Math.abs(doorX - currentX);
        if (distance < 10) {
          door.style.cursor = 'pointer';
          door.style.filter = 'brightness(1.2)';
          // Show hint for door 1
          if (index === 0) {
            helpText.textContent = "Door 1 is within reach! Click on it to interact.";
          }
        } else {
          door.style.cursor = 'default';
          door.style.filter = 'brightness(0.7)';
        }
      });
    }
    
    // Handle forward movement - actually move forward in the corridor
    function moveForward() {
      if (isForwardMode) {
        // Actually move forward in the corridor instead of just scaling
        currentX += moveSpeed;
        if (currentX > maxX) currentX = maxX;
        
        // Apply a small visual effect for forward movement
        currentZ += 5;
        if (currentZ < 100) {
          player.style.transform = `translateZ(${currentZ}px) scale(${1 + currentZ/100})`;
          requestAnimationFrame(moveForward);
        } else {
          // We've reached the maximum forward position
          // Reset the visual effect
          setTimeout(() => {
            player.style.transform = '';
            currentZ = 0;
            
            // If we're targeting a door, show it
            if (targetDoorIndex >= 0) {
              showDoorView(targetDoorIndex);
            }
            
            isForwardMode = false;
            updatePosition();
          }, 300);
        }
      }
    }
    
    // Reset forward movement
    function resetForwardMovement() {
      isForwardMode = false;
      currentZ = 0;
      targetDoorIndex = -1;
      player.style.transform = '';
      updatePosition();
    }
    
    // Joystick variables
    let isDragging = false;
    let joystickCenterX = joystickContainer.offsetWidth / 2;
    let joystickCenterY = joystickContainer.offsetHeight / 2;
    let joystickRadius = joystickContainer.offsetWidth / 2 - joystickKnob.offsetWidth / 2;
    let joystickX = 0;
    let joystickY = 0;
    let moveInterval = null;
    
    // Initialize joystick position
    function initJoystick() {
      joystickCenterX = joystickContainer.offsetWidth / 2;
      joystickCenterY = joystickContainer.offsetHeight / 2;
      joystickRadius = joystickContainer.offsetWidth / 2 - joystickKnob.offsetWidth / 2;
      
      // Position the knob in the center
      joystickKnob.style.left = joystickCenterX + 'px';
      joystickKnob.style.top = joystickCenterY + 'px';
    }
    
    // Call init on window resize
    window.addEventListener('resize', initJoystick);
    
    // Joystick event handlers
    joystickKnob.addEventListener('mousedown', startDrag);
    joystickKnob.addEventListener('touchstart', startDrag, { passive: false });
    document.addEventListener('mousemove', drag);
    document.addEventListener('touchmove', drag, { passive: false });
    document.addEventListener('mouseup', stopDrag);
    document.addEventListener('touchend', stopDrag);
    
    function startDrag(e) {
      isDragging = true;
      joystickKnob.style.transition = 'none';
      e.preventDefault();
    }
    
    function drag(e) {
      if (!isDragging) return;
      
      e.preventDefault();
      
      // Get touch or mouse position
      let clientX, clientY;
      if (e.type.startsWith('touch')) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      
      // Get joystick container position
      const rect = joystickContainer.getBoundingClientRect();
      
      // Calculate position relative to joystick center
      let x = clientX - rect.left - joystickCenterX;
      let y = clientY - rect.top - joystickCenterY;
      
      // Calculate distance from center
      const distance = Math.sqrt(x * x + y * y);
      
      // Limit distance to radius
      if (distance > joystickRadius) {
        x = (x / distance) * joystickRadius;
        y = (y / distance) * joystickRadius;
      }
      
      // Update joystick position
      joystickKnob.style.left = (joystickCenterX + x) + 'px';
      joystickKnob.style.top = (joystickCenterY + y) + 'px';
      
      // Store normalized joystick position (-1 to 1)
      joystickX = x / joystickRadius;
      joystickY = y / joystickRadius;
      
      // Move based on joystick position
      moveWithJoystick();
    }
    
    function stopDrag() {
      if (!isDragging) return;
      
      isDragging = false;
      joystickKnob.style.transition = 'all 0.2s';
      joystickKnob.style.left = joystickCenterX + 'px';
      joystickKnob.style.top = joystickCenterY + 'px';
      
      // Reset joystick position
      joystickX = 0;
      joystickY = 0;
      
      // Stop movement
      clearInterval(moveInterval);
      moveInterval = null;
    }
    
    function moveWithJoystick() {
      // Clear any existing interval
      if (moveInterval) {
        clearInterval(moveInterval);
      }
      
      // Set up a new interval for smooth movement
      moveInterval = setInterval(() => {
        // Only move if joystick is significantly displaced
        if (Math.abs(joystickX) > 0.1) {
          resetForwardMovement();
          
          // Move left or right based on joystick X position
          const moveAmount = joystickX * moveSpeed;
          currentX += moveAmount;
          
          // Clamp position within bounds
          if (currentX < 0) currentX = 0;
          if (currentX > maxX) currentX = maxX;
          
          updatePosition();
        }
        
        // Forward/backward movement based on joystick Y position
        if (Math.abs(joystickY) > 0.3) {
          // Forward movement (negative Y is up)
          if (joystickY < 0) {
            // Move forward (closer to doors)
            let nearDoor = false;
            doors.forEach((door, index) => {
              const doorX = 200 + (index * 30);
              const distance = Math.abs(doorX - currentX);
              
              if (distance < 10) {
                nearDoor = true;
                isForwardMode = true;
                targetDoorIndex = index;
              }
            });
            
            // If not near any door, still move forward
            if (!nearDoor) {
              isForwardMode = true;
              targetDoorIndex = -1;
            }
            
            // Start the animation loop
            if (isForwardMode) {
              requestAnimationFrame(moveForward);
            }
          } else {
            // Move backward (away from doors)
            resetForwardMovement();
            // Move back slightly
            currentX -= Math.abs(joystickY) * moveSpeed * 0.5;
            if (currentX < 0) currentX = 0;
            updatePosition();
          }
        }
      }, 50); // Update every 50ms for smooth movement
    }
    
    // Function to handle forward movement
    function handleForwardMovement() {
      // Reset any existing forward movement
      resetForwardMovement();
      
      // Check if we're near a door
      let nearDoor = false;
      doors.forEach((door, index) => {
        const doorX = 200 + (index * 30);
        const distance = Math.abs(doorX - currentX);
        
        if (distance < 10) {
          nearDoor = true;
          isForwardMode = true;
          targetDoorIndex = index;
        }
      });
      
      // If not near any door, still move forward
      if (!nearDoor) {
        isForwardMode = true;
        targetDoorIndex = -1;
      }
      
      // Start the animation loop
      if (isForwardMode) {
        requestAnimationFrame(moveForward);
      }
    };
    
    // Function to start forward movement animation
    function startForwardMovement() {
      if (isForwardMode) {
        requestAnimationFrame(moveForward);
      }
    }
    
    // Handle keyboard controls
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'a') {
        resetForwardMovement();
        if (currentX > 0) {
          currentX -= moveSpeed;
          updatePosition();
        }
      } else if (e.key === 'ArrowRight' || e.key === 'd') {
        resetForwardMovement();
        if (currentX < maxX) {
          currentX += moveSpeed;
          updatePosition();
        }
      } else if (e.key === 'ArrowUp' || e.key === 'w') {
        // Move forward (closer to doors)
        let nearDoor = false;
        doors.forEach((door, index) => {
          const doorX = 200 + (index * 30);
          const distance = Math.abs(doorX - currentX);
          
          if (distance < 10) {
            nearDoor = true;
            isForwardMode = true;
            targetDoorIndex = index;
          }
        });
        
        // If not near any door, still move forward
        if (!nearDoor) {
          isForwardMode = true;
          targetDoorIndex = -1;
        }
        
        // Start the animation loop
        if (isForwardMode) {
          requestAnimationFrame(moveForward);
        }
      } else if (e.key === 'ArrowDown' || e.key === 's') {
        // Move backward (away from doors)
        resetForwardMovement();
        // Move back slightly
        currentX -= moveSpeed * 0.5;
        if (currentX < 0) currentX = 0;
        updatePosition();
      }
    });
    
    // Handle door clicks
    doors.forEach((door, index) => {
      door.addEventListener('click', () => {
        const doorX = 200 + (index * 30);
        const distance = Math.abs(doorX - currentX);
        
        // Only interact with doors that are close enough
        if (distance < 10) {
          // Add swing animation to the door
          door.style.transition = 'transform 1s ease-in-out';
          door.style.transformOrigin = 'left';
          door.style.transform = 'rotateY(-80deg)';
          
          // Show a message
          helpText.textContent = `You've opened Door ${index + 1}! Explore what's inside...`;
          
          // After animation completes, show the door view
          setTimeout(() => {
            showDoorView(index);
            // Reset door transform after showing door view
            setTimeout(() => {
              door.style.transform = '';
            }, 500);
          }, 1000);
        }
      });
    });
    
    // Auto-open first door when initially in range
    function checkFirstDoor() {
      const doorX = 200; // Door 1 position
      const distance = Math.abs(doorX - currentX);
      
      if (distance < 10) {
        doors[0].style.transform = 'scale(1.05)';
      }
    }
    
    // Show door view
    function showDoorView(doorIndex) {
      // Reset forward movement when showing door view
      isForwardMode = false;
      
      // Display the door view
      doorView.style.display = 'flex';
      currentDoor.querySelector('.door-number').textContent = doorIndex + 1;
      
      // Set a special style for door 5
      if (doorIndex === 4) {
        currentDoor.style.backgroundColor = '#4a1c82';
        currentDoor.style.borderColor = '#321258';
        currentDoor.style.boxShadow = '0 0 30px rgba(148, 0, 211, 0.9)';
        currentDoor.querySelector('.door-number').style.color = 'gold';
        currentDoor.querySelector('.doorknob').style.backgroundColor = 'gold';
      } else {
        currentDoor.style.backgroundColor = '#5a3921';
        currentDoor.style.borderColor = '#412a18';
        currentDoor.style.boxShadow = '0 0 30px black';
        currentDoor.querySelector('.door-number').style.color = '#ccc';
        currentDoor.querySelector('.doorknob').style.backgroundColor = '#b8860b';
      }
      
      // Special highlight for door 1
      if (doorIndex === 0) {
        currentDoor.style.boxShadow = '0 0 30px rgba(255, 255, 0, 0.8)';
      }
      
      // Reset door state and content
      currentDoor.classList.remove('door-open');
      currentDoor.classList.add('door-closed');
      doorContent.style.opacity = '0';
      doorContent.textContent = '';
      
      // Remove any existing click handlers
      currentDoor.onclick = null;
      
      // Make all doors clickable to open
      currentDoor.onclick = function() {
        // Remove the closed class and add the open class
        this.classList.remove('door-closed');
        this.classList.add('door-open');
        
        // Show content after door opens
        setTimeout(() => {
          doorContent.textContent = doorContents[doorIndex];
          doorContent.style.opacity = '1';
          
          // If it's door 5, show game over after a delay
          if (doorIndex === 4) {
            setTimeout(() => {
              showGameOver("Congratulations! You've completed the Corridor Adventure!");
            }, 3000);
          }
        }, 800);
      };
      
      // Make sure the door is clickable
      currentDoor.style.cursor = 'pointer';
    }
    
    // Close door view
    closeDoorViewButton.addEventListener('click', () => {
      doorView.style.display = 'none';
      resetForwardMovement();
    });
    
    // Show game over screen
    function showGameOver(message) {
      gameOver.style.display = 'flex';
      gameOverMessage.textContent = message;
    }
    
    // Restart game
    restartButton.addEventListener('click', () => {
      currentX = 0;
      resetForwardMovement();
      updatePosition();
      gameOver.style.display = 'none';
      doorView.style.display = 'none';
    });
    
    // Set initial position near door 1
    function moveToDoor1() {
      currentX = 200;
      updatePosition();
      checkFirstDoor();
    }
    
    // Initialize
    setTimeout(() => {
      moveToDoor1();
      initJoystick();
    }, 1000);
    
    // Add some dynamic vines and leaves
    function addDynamicElements() {
      // Add more vines at different positions
      for (let i = 0; i < 10; i++) {
        const vine = document.createElement('div');
        vine.className = 'vine';
        vine.style.left = (Math.random() * 100) + 100 + 'vw'; // Position along the corridor
        vine.style.height = (20 + Math.random() * 30) + 'vh';
        vine.style.transform = `rotate(${Math.random() * 10 - 5}deg)`;
        document.getElementById('wall').appendChild(vine);
        
        // Add some leaves to the vine
        const leafCount = Math.floor(Math.random() * 3) + 1;
        for (let j = 0; j < leafCount; j++) {
          const leaf = document.createElement('div');
          leaf.className = 'leaf';
          leaf.style.position = 'absolute';
          leaf.style.top = (Math.random() * 100) + '%';
          leaf.style.left = (Math.random() * 10 - 5) + 'px';
          leaf.style.animationDuration = (5 + Math.random() * 10) + 's';
          vine.appendChild(leaf);
        }
      }
      
      // Add more stars
      for (let i = 0; i < 30; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.top = (Math.random() * 40) + '%';
        star.style.left = (Math.random() * 300 + 50) + 'vw'; // Position along the corridor
        star.style.animationDelay = (Math.random() * 4) + 's';
        if (Math.random() > 0.7) {
          star.style.width = '3px';
          star.style.height = '3px';
        }
        document.getElementById('wall').appendChild(star);
      }
    }
    
    // Call the function to add dynamic elements
    addDynamicElements();
  </script>
</body>
</html>